# HTML 解析和优化

> HTML解析的流程是：下载HTML → 解析HTML → 构建DOM树 → 下载css → 解析css → 构建css树 → 下载js → 执行js

### HTML
在以上过程中 html 的解析会被 js 的下载和执行阻塞。

### CSS
css的下载和解析会阻塞 js 的执行，因为在 js 中可能会读取 css 的属性值。

### JavaScript
在浏览器解析传入的html代码的时候，当执行到script这个标签的时候，就会发送一个http请求，下载JS代码，并且这个时候html会被阻塞，下载之后，JS代码会被执行，这个时候html线程仍被阻塞，直到JS代码执行完毕才会继续执行html代码。
（因为我们在解析js的时候，有可能会对html的DOM产生影响，可能会有 document.write. 这意味着，在当前 JS 加载和执行完成前，后续所有资源的下载有可能是没必要的。 这是 JS 阻塞后续资源下载的根本原因。

## 如何优化
[HTML 渲染优化](https://godbasin.github.io/2022/05/15/front-end-performance-render/)
1. 首屏内容加载
   1. 使用骨架屏幕预渲染
   2. 使用服务端渲染
   3. 仅加载需要的资源，通过异步加载的方式加载剩余资源
   4. 合理使用缓存
2. 首屏内容渲染优化
   1. 将 CSS 放在 Head 内避免浏览器渲染的重新计算
   2. 将 JavaScript 放在 body 的后面，避免资源阻塞也没渲染
   3. 减少 DOM 数量和嵌套，减少浏览器渲染过程中的计算耗时
   4. 合理使用 GPU 合成
3. 用户操作优化
   1. 事件委托，对于用户交互频繁的场景，我们还得注意事件的绑定。通过将事件绑定在父元素上，可以减少对浏览器的元素的监听。
4. 页面渲染
   1. 减少/何必 DOM 操作，减少页面更新的内容范围，减少浏览器渲染过程耗时
   2. 对于页面动画，可以 CSS 动画属性，而不是改变 DOM 属性
   3. 使用资源预加载


## 浏览器的组成
浏览器是由外壳、浏览器引擎、渲染引擎、JS引擎、网络等组成。
* 外壳：用户可以看到的界面，包括地址栏、后退/前进按钮、书签目录等。
* 浏览器引擎：可以在用户界面和渲染引擎之间传送指令或在客户端本地缓存中读写数据等，是浏览器中各个部分之间相互通信的核心。
* 渲染引擎：解析DOM文档和CSS规则并将内容排版到浏览器中显示有样式的界面，常说的浏览器内核主要指的就是渲染引擎。
* 网络：用来完成网络调用或资源下载的模块。
* JS引擎：用来解释执行JS脚本的模块，如 V8 引擎、JavaScriptCore。

